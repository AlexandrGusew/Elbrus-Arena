# Логика и механика игры - Dark Fantasy PvP/PvE (Telegram Mini App)

## 1. Общая концепция

### 1.1 Описание игры
Онлайн-игра в жанре дарк-фэнтези с тактическими пошаговыми боями, реализованная как Telegram Mini App. Игроки создают персонажей, развивают их через PvE-данжи, получают экипировку и сражаются друг с другом в PvP-арене.

### 1.2 Платформа
- **Единственная платформа**: Telegram Mini App
- **Авторизация**: через Telegram ID
- **Интеграция**: Telegram Bot для уведомлений

### 1.3 Core Game Loop
1. Вход через Telegram → Создание/выбор персонажа
2. Трата стамины на PvE данжи → Получение опыта и лута
3. Улучшение экипировки у кузнеца → Повышение статов
4. PvP арена → Борьба за рейтинг
5. Ежедневный возврат для восстановления стамины

## 2. Классы персонажей

### 2.1 Воин
- **Основная характеристика**: Сила
- **Стартовые статы**: 
  - Сила: 15
  - Ловкость: 8  
  - Интеллект: 5
  - HP: 150
- **Особенности**: Больше HP, сильнее базовый удар
- **Способность "Ярость"**: 
  - Эффект: +15% к силе на 2 хода
  - Откат: -5% к силе на 1 ход после окончания
  - Использование: 1 раз за бой
  - НЕ тратит ход

### 2.2 Убийца
- **Основная характеристика**: Ловкость
- **Стартовые статы**:
  - Сила: 8
  - Ловкость: 15
  - Интеллект: 8
  - HP: 100
- **Особенности**: Меньше HP, выше шанс крита и уворота
- **Способность "Скрытность"**:
  - Эффект: +30% к уклонению на 2 хода
  - Побочный эффект: следующий удар по убийце гарантированно критический
  - Использование: 1 раз за бой
  - НЕ тратит ход

### 2.3 Маг
- **Основная характеристика**: Интеллект
- **Стартовые статы**:
  - Сила: 5
  - Ловкость: 10
  - Интеллект: 15
  - HP: 120
- **Особенности**: Средние HP, может атаковать 3 зоны за ход (базово)
- **Способность "Сверх-разум"**:
  - Эффект: +1 дополнительная атака на 2 хода (итого 4 атаки)
  - Откат: пропуск одного хода после окончания
  - Использование: 1 раз за бой
  - НЕ тратит ход при активации

## 3. Боевая система

### 3.1 Зоны атаки и защиты
- **Зоны тела**: 
  - Голова
  - Торс
  - Пояс
  - Ноги
- **Правила выбора**:
  - Атака: 2 зоны (маг базово может 3)
  - Защита: максимум 3 зоны
- **Время на ход**: 10 секунд

### 3.2 Модификаторы урона по зонам
- **Голова**: x1.1 (повышенный урон)
- **Торс**: x1.0 (стандартный урон)
- **Пояс**: x0.9
- **Ноги**: x0.8 (пониженный урон)

### 3.3 Формула расчета урона

#### Базовый урон
```
Базовый_урон = Урон_оружия + Основная_характеристика_класса
```

#### Модифицированный урон
```
Модифицированный_урон = Базовый_урон × Модификатор_зоны
```

#### Финальный урон (без блока)
```
Финальный_урон = Модифицированный_урон × (1 - Броня_противника/100)
```

#### При попадании в защищаемую зону (блок)
```
Заблокированный_урон = Финальный_урон - (Броня_защищающегося × 0.6)
```
Минимальный урон после блока = 1

#### При критическом ударе
```
Крит_урон = Финальный_урон × (2 + Основная_характеристика × 0.002)
```

### 3.4 Механика блока
- Если атака попадает в защищаемую зону - применяется формула блокирования
- **Формула блока**: `Урон_после_блока = Урон - (Броня × 0.6)`
- Пробития блока НЕТ - блок всегда работает при попадании в защищаемую зону

### 3.5 Механика уворота
- **Базовый шанс**: 5%
- **Формула**: `Шанс_уворота = 5% + Ловкость × 0.3%`
- **Максимальный кап**: 75%

### 3.6 Критические удары
- **Базовый шанс**: 15%
- **Формула шанса**: `15% + Ловкость × 0.3% + Бонусы_от_экипировки`
- **Множитель урона**: `2.0 + Основная_характеристика × 0.002`

## 4. Система прогрессии

### 4.1 Уровни персонажа
- **Максимальный уровень**: Без ограничений
- **За повышение уровня**:
  - Основная характеристика класса: +3
  - Остальные характеристики: +1 каждая
  - Свободные очки: +3 для распределения
- **Сброс характеристик**: Доступен (за золото)

### 4.2 Источники опыта
- PvE бои (зависит от сложности данжа)
- PvP победы
- Ежедневные задания (в будущем)

## 5. Экипировка

### 5.1 Слоты экипировки
- Голова (шлем)
- Торс (броня)
- Пояс
- Ноги (поножи)
- Оружие

### 5.2 Редкость предметов
1. **Обычный** (серый)
   - Базовые статы (определяем вручную для каждого предмета)
2. **Редкий** (синий)
   - Усиленные статы (определяем вручную)
3. **Эпический** (фиолетовый)
   - Сильно усиленные статы (определяем вручную)
4. **Легендарный** (оранжевый)
   - Максимальные статы (определяем вручную)

### 5.3 Требования экипировки
- Минимальный уровень персонажа
- Минимальные характеристики (например: Сила 20 для тяжелой брони)

### 5.4 Заточка предметов
- **Локация**: Кузнец
- **Максимальный уровень заточки**: +10
- **Бонус за уровень заточки**: +10% к статам предмета
- **На +10**: итого +100% к статам (удвоение)
- **Шанс успеха**: 30%
- **При неудаче**: предмет НЕ ломается, попытка тратится
- **Стоимость**: Золото (прогрессивное увеличение цены)

## 6. PvE система

### 6.1 Структура данжа
- 4 обычных врага (последовательно)
- 1 босс в конце
- HP не восстанавливается между боями
- Можно использовать 1 зелье за весь данж
- Выход из данжа = потеря всего прогресса

### 6.2 Уровни сложности
1. **Легкий**
   - Враги: стандартные статы
   - Награды: базовые
2. **Средний**
   - Враги: стандартные статы
   - Награды: × 1.5
3. **Сложный**
   - Враги: стандартные статы
   - Награды: × 2

### 6.3 Стамина
- **Максимум**: 100 единиц
- **Расход**: 20 за вход в данж
- **Восстановление**: 1 единица за 6 минут (полное за 10 часов)

### 6.4 Враги
Создаются вручную с уникальными характеристиками:
- **Обычные враги**: уникальные имена, статы, паттерны атак
- **Боссы**: усиленные версии с особыми механиками

### 6.5 Награды
- **Гарантированно**: опыт и золото
- **Дроп экипировки**: 1 случайный предмет из пула (1 из 15)
- **Шанс по редкости** (определяется для каждого данжа):
  - Обычный: 60%
  - Редкий: 30%
  - Эпический: 8%
  - Легендарный: 2%

## 7. PvP система

### 7.1 Арена 1v1
- **Тип**: Реальное время через WebSocket
- **Подбор противников**: ±200 рейтинга
- **Время поиска**: максимум 30 секунд
- **Если не найден противник**: поиск отменяется (без ботов)

### 7.2 Рейтинговая система
- **Стартовый рейтинг**: 0
- **За победу**: +15 очков
- **За поражение**: -30 очков
- **Минимальный рейтинг**: 0 (не может уйти в минус)

### 7.3 Награды PvP
- Опыт (больше чем в PvE)
- Золото за победу
- Изменение рейтинга

### 7.4 Таблица лидеров
- Топ-10 игроков по рейтингу
- Обновление в реальном времени
- Видны: имя, класс, уровень, рейтинг

## 8. Расходные предметы

### 8.1 Зелье здоровья
- **Эффект**: восстанавливает 20% от максимального HP
- **Использование в бою**: 1 раз за бой
- **НЕ тратит ход**
- **Получение**: покупка в магазине, дроп с врагов

## 9. Экономика

### 9.1 Валюты
#### Золото (единственная валюта в MVP)
- **Получение**:
  - PvE данжи
  - PvP победы
- **Трата**:
  - Заточка экипировки
  - Покупка зелий
  - Сброс характеристик

## 10. Баланс и ограничения

### 10.1 Жесткие лимиты
- Максимальный уворот: 75%
- Максимальная заточка: +10
- Минимальный урон: всегда >= 1
- Максимум зон атаки: 2 (3 для мага)
- Максимум зон защиты: 3
- Время на ход: 10 секунд

### 10.2 Защита от абуза
- Все расчеты на сервере
- Валидация всех действий
- Таймауты на все операции
- Логирование подозрительной активности

## 11. Социальные механики (Post-MVP)

### 11.1 Будущие фичи
- **Гильдии/кланы**: объединения игроков
- **Командные рейды**: 3 игрока против усиленного босса
- **Торговля**: обмен предметами между игроками
- **Турниры**: сетка на вылет для определения чемпиона

## 12. Telegram интеграция

### 12.1 Авторизация
- Автоматический вход через Telegram ID
- Имя из Telegram профиля
- Аватар из Telegram (опционально)

### 12.2 Уведомления через бота
- Восстановление стамины
- Найден противник в PvP
- Новости и события

### 12.3 Социальные функции
- Приглашение друзей из Telegram
- Шаринг достижений в чаты
- Реферальная система

## 13. Метрики успеха

### 13.1 KPI для MVP
- DAU: 100+ активных игроков
- Retention D1: >40%
- Retention D7: >20%
- Среднее время сессии: >10 минут
- PvP матчей в день: >50

### 13.2 Монетизация (Post-MVP)
- ARPU: $0.5-1
- Conversion to paying: 5-10%
- Средний чек: $5-10

## 14. Технические требования

### 14.1 Производительность
- Загрузка игры: <3 секунды
- Отклик на действия: <100ms
- FPS в боях: 30+
- Размер приложения: <5MB

### 14.2 Совместимость
- Все версии Telegram с поддержкой Mini Apps
- iOS 12+
- Android 7+
- Работа при слабом интернете (3G)
